<div class="bg-base-100 p-6 rounded-xl shadow h-full flex flex-col animate-fade-in">
  @if (selectedProject(); as project) {
    <!-- Project Header -->
    <div class="flex-shrink-0 pb-4 border-b border-gray-200">
      <div class="flex flex-col sm:flex-row justify-between items-start gap-4">
        <div class="flex-grow">
          <label for="project-selector" class="text-sm font-medium text-gray-500">المشروع الحالي</label>
          <select id="project-selector" (change)="selectProject($event)" class="block w-full mt-1 p-2 text-2xl font-bold bg-base-100 border-0 border-b-2 border-gray-200 focus:ring-0 focus:border-ph-blue transition">
            @for(p of projects(); track p.id) {
              <option [value]="p.id" [selected]="p.id === project.id">{{ p.name }}</option>
            }
          </select>
        </div>
        <div class="flex items-center gap-2 flex-shrink-0">
          @if(isDataExportEnabled()) {
            <div class="relative inline-block text-left group">
                <button class="px-3 py-2 text-sm font-medium rounded-lg flex items-center bg-gray-100 hover:bg-gray-200">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 me-2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" /></svg>
                    تصدير
                </button>
                <div class="absolute right-0 mt-2 w-32 origin-top-right rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none hidden group-hover:block z-10">
                    <div class="py-1">
                    <a (click)="exportData('csv')" href="javascript:void(0)" class="text-gray-700 block px-4 py-2 text-sm hover:bg-gray-100">CSV</a>
                    <a (click)="exportData('json')" href="javascript:void(0)" class="text-gray-700 block px-4 py-2 text-sm hover:bg-gray-100">JSON</a>
                    </div>
                </div>
            </div>
          }
           <button (click)="openCreateProjectModal()" class="px-3 py-2 text-sm font-medium rounded-lg flex items-center bg-gray-100 hover:bg-gray-200">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 me-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>
            مشروع جديد
          </button>
          <div class="flex items-center -space-x-2">
            @for(member of project.team; track member.id) {
              <img class="w-10 h-10 rounded-full border-2 border-white object-cover" [src]="member.avatar" [alt]="member.name" [title]="member.name">
            }
            <button (click)="openInviteMemberModal()" class="flex items-center justify-center w-10 h-10 text-xs font-medium text-white bg-ph-blue rounded-full border-2 border-white hover:bg-ph-blue-dark" title="دعوة عضو">+
            </button>
          </div>
        </div>
      </div>
       <div class="mt-4">
        <div class="flex justify-between mb-1">
          <span class="text-base font-medium text-ph-blue">تقدم المشروع</span>
          <span class="text-sm font-medium text-ph-blue">{{ projectProgress() }}%</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-2.5">
          <div class="bg-ph-blue h-2.5 rounded-full" [style.width.%]="projectProgress()"></div>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="flex-shrink-0 border-b border-gray-200 mt-4">
       <div class="flex justify-between items-center">
        <nav class="-mb-px flex space-i-6" aria-label="Tabs">
            <button (click)="setTab('tasks')" [class]="activeTab() === 'tasks' ? 'border-ph-blue text-ph-blue' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-4 px-2 border-b-2 font-medium text-sm">
            المهام
            </button>
            <button (click)="setTab('files')" [class]="activeTab() === 'files' ? 'border-ph-blue text-ph-blue' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-4 px-2 border-b-2 font-medium text-sm">
            الملفات
            </button>
            <button (click)="setTab('discussion')" [class]="activeTab() === 'discussion' ? 'border-ph-blue text-ph-blue' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-4 px-2 border-b-2 font-medium text-sm">
            النقاشات
            </button>
            @if (isWebRtcEnabled()) {
            <button (click)="setTab('meeting')" [class]="activeTab() === 'meeting' ? 'border-ph-blue text-ph-blue' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="whitespace-nowrap py-4 px-2 border-b-2 font-medium text-sm">
                اجتماع مباشر
            </button>
            }
        </nav>
         @if (activeTab() === 'tasks') {
          <div>
            <label for="task-filter" class="sr-only">Filter by assignee</label>
            <select id="task-filter" (change)="setFilter($event)" class="text-sm rounded-lg bg-gray-100 border-gray-300">
              <option value="all" selected>عرض كل المهام</option>
              @for(member of project.team; track member.id) {
                <option [value]="member.id">مهام {{member.name}}</option>
              }
            </select>
          </div>
        }
      </div>
    </div>

    <!-- Tab Content -->
    <div class="flex-grow pt-6 overflow-hidden">
      @switch (activeTab()) {
        @case ('tasks') {
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6 h-full">
            <!-- To Do Column -->
            <div (dragover)="onDragOver($event, 'todo')" (dragleave)="onDragLeave()" (drop)="onDrop($event, 'todo')" class="flex flex-col rounded-lg transition-colors" [class.bg-blue-100/50]="dragOverStatus() === 'todo'">
              <h3 class="font-bold text-center p-2 bg-blue-200/80 rounded-t-lg text-blue-800 border-b-2 border-blue-300 flex justify-between items-center">
                <span>المهام المطلوبة ({{filteredTasks().todo.length}})</span>
                <button (click)="openAddTaskModal('todo')" title="إضافة مهمة" class="p-1 rounded-full hover:bg-blue-300/50 text-lg">+</button>
              </h3>
              <div class="p-3 space-y-3 bg-blue-100/50 rounded-b-lg h-full overflow-y-auto">
                @for(task of filteredTasks().todo; track task.id) {
                  <div draggable="true" (dragstart)="onDragStart(task.id)" class="relative group p-3 bg-base-100 rounded-lg shadow-sm cursor-grab active:cursor-grabbing border-s-4" [ngClass]="{'border-red-500': task.priority === 'High', 'border-yellow-500': task.priority === 'Medium', 'border-green-500': task.priority === 'Low'}">
                    <button (click)="deleteTask(task.id, 'todo')" title="حذف المهمة" class="absolute top-1 end-1 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity p-0.5 rounded-full hover:bg-gray-100">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg>
                    </button>
                    <p class="font-semibold text-sm">{{ task.title }}</p>
                    <div class="flex justify-between items-center mt-2 text-xs text-gray-500">
                        <div class="flex items-center gap-2">
                           <span class="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 me-1"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0h18" /></svg> {{ task.dueDate }}</span>
                           <span class="px-2 py-0.5 rounded-full font-semibold" [ngClass]="{'bg-green-100 text-green-800': task.difficulty === 'Easy', 'bg-yellow-100 text-yellow-800': task.difficulty === 'Medium', 'bg-red-100 text-red-800': task.difficulty === 'Hard'}">
                             {{ task.difficulty === 'Easy' ? 'سهلة' : (task.difficulty === 'Medium' ? 'متوسطة' : 'صعبة') }}
                           </span>
                        </div>
                       <img [src]="task.assignee.avatar" [title]="task.assignee.name" class="w-6 h-6 rounded-full object-cover">
                    </div>
                  </div>
                }
              </div>
            </div>
            <!-- In Progress Column -->
            <div (dragover)="onDragOver($event, 'inProgress')" (dragleave)="onDragLeave()" (drop)="onDrop($event, 'inProgress')" class="flex flex-col rounded-lg transition-colors" [class.bg-yellow-100/50]="dragOverStatus() === 'inProgress'">
              <h3 class="font-bold text-center p-2 bg-yellow-200/80 rounded-t-lg text-yellow-800 border-b-2 border-yellow-300 flex justify-between items-center">
                <span>قيد التنفيذ ({{filteredTasks().inProgress.length}})</span>
                 <button (click)="openAddTaskModal('inProgress')" title="إضافة مهمة" class="p-1 rounded-full hover:bg-yellow-300/50 text-lg">+</button>
              </h3>
              <div class="p-3 space-y-3 bg-yellow-100/50 rounded-b-lg h-full overflow-y-auto">
                @for(task of filteredTasks().inProgress; track task.id) {
                  <div draggable="true" (dragstart)="onDragStart(task.id)" class="relative group p-3 bg-base-100 rounded-lg shadow-sm cursor-grab active:cursor-grabbing border-s-4" [ngClass]="{'border-red-500': task.priority === 'High', 'border-yellow-500': task.priority === 'Medium', 'border-green-500': task.priority === 'Low'}">
                    <button (click)="deleteTask(task.id, 'inProgress')" title="حذف المهمة" class="absolute top-1 end-1 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity p-0.5 rounded-full hover:bg-gray-100">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg>
                    </button>
                    <p class="font-semibold text-sm">{{ task.title }}</p>
                    <div class="flex justify-between items-center mt-2 text-xs text-gray-500">
                       <div class="flex items-center gap-2">
                           <span class="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 me-1"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0h18" /></svg> {{ task.dueDate }}</span>
                           <span class="px-2 py-0.5 rounded-full font-semibold" [ngClass]="{'bg-green-100 text-green-800': task.difficulty === 'Easy', 'bg-yellow-100 text-yellow-800': task.difficulty === 'Medium', 'bg-red-100 text-red-800': task.difficulty === 'Hard'}">
                             {{ task.difficulty === 'Easy' ? 'سهلة' : (task.difficulty === 'Medium' ? 'متوسطة' : 'صعبة') }}
                           </span>
                        </div>
                       <img [src]="task.assignee.avatar" [title]="task.assignee.name" class="w-6 h-6 rounded-full object-cover">
                    </div>
                  </div>
                }
              </div>
            </div>
            <!-- Done Column -->
            <div (dragover)="onDragOver($event, 'done')" (dragleave)="onDragLeave()" (drop)="onDrop($event, 'done')" class="flex flex-col rounded-lg transition-colors" [class.bg-green-100/50]="dragOverStatus() === 'done'">
              <h3 class="font-bold text-center p-2 bg-green-200/80 rounded-t-lg text-green-800 border-b-2 border-green-300 flex justify-between items-center">
                <span>تم الإنجاز ({{filteredTasks().done.length}})</span>
                 <button (click)="openAddTaskModal('done')" title="إضافة مهمة" class="p-1 rounded-full hover:bg-green-300/50 text-lg">+</button>
              </h3>
              <div class="p-3 space-y-3 bg-green-100/50 rounded-b-lg h-full overflow-y-auto">
                @for(task of filteredTasks().done; track task.id) {
                  <div draggable="true" (dragstart)="onDragStart(task.id)" class="relative group p-3 bg-base-100 rounded-lg shadow-sm cursor-grab active:cursor-grabbing border-s-4 border-gray-400 opacity-70">
                    <button (click)="deleteTask(task.id, 'done')" title="حذف المهمة" class="absolute top-1 end-1 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity p-0.5 rounded-full hover:bg-gray-100">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg>
                    </button>
                    <p class="font-semibold text-sm line-through">{{ task.title }}</p>
                     <div class="flex justify-between items-center mt-2 text-xs text-gray-500">
                       <div class="flex items-center gap-2">
                           <span class="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 me-1"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0h18" /></svg> {{ task.dueDate }}</span>
                           <span class="px-2 py-0.5 rounded-full font-semibold" [ngClass]="{'bg-green-100 text-green-800': task.difficulty === 'Easy', 'bg-yellow-100 text-yellow-800': task.difficulty === 'Medium', 'bg-red-100 text-red-800': task.difficulty === 'Hard'}">
                             {{ task.difficulty === 'Easy' ? 'سهلة' : (task.difficulty === 'Medium' ? 'متوسطة' : 'صعبة') }}
                           </span>
                        </div>
                       <img [src]="task.assignee.avatar" [title]="task.assignee.name" class="w-6 h-6 rounded-full object-cover">
                    </div>
                  </div>
                }
              </div>
            </div>
          </div>
        }
        @case ('files') {
          <div class="bg-base-200/50 p-4 rounded-lg h-full overflow-y-auto">
            <table class="w-full text-sm text-right text-gray-600">
                <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                    <tr>
                        <th scope="col" class="py-3 px-6">اسم الملف</th>
                        <th scope="col" class="py-3 px-6">الحجم</th>
                        <th scope="col" class="py-3 px-6">آخر تعديل</th>
                    </tr>
                </thead>
                <tbody>
                    @for(file of project.files; track file.name) {
                      <tr class="bg-base-100 border-b hover:bg-gray-50 cursor-pointer">
                          <td class="py-4 px-6 font-medium text-gray-900 whitespace-nowrap flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 me-3 text-ph-blue">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
                            </svg>
                            {{ file.name }}
                          </td>
                          <td class="py-4 px-6">{{ file.size }}</td>
                          <td class="py-4 px-6">{{ file.lastModified }}</td>
                      </tr>
                    } @empty {
                       <tr><td colspan="3" class="text-center py-8 text-gray-500">لا توجد ملفات في هذا المشروع بعد.</td></tr>
                    }
                </tbody>
            </table>
          </div>
        }
        @case ('discussion') {
          <div class="h-full flex flex-col bg-base-200/50 rounded-lg">
            <div class="flex-grow p-4 space-y-4 overflow-y-auto">
              @for(message of project.discussion; track message.id) {
                <div class="flex items-end gap-2" [class.justify-end]="message.sender.id === project.team[0].id" [class.flex-row-reverse]="message.sender.id === project.team[0].id">
                  <img [src]="message.sender.avatar" class="w-8 h-8 rounded-full object-cover">
                  <div class="p-3 rounded-lg max-w-lg" [class]="message.sender.id === project.team[0].id ? 'bg-ph-blue text-white rounded-t-xl rounded-s-xl' : 'bg-base-100 rounded-t-xl rounded-e-xl'">
                    <p class="text-sm">{{ message.text }}</p>
                    <p class="text-xs mt-1" [class.text-gray-200/70]="message.sender.id === project.team[0].id" [class.text-gray-500]="message.sender.id !== project.team[0].id">{{ message.timestamp }}</p>
                  </div>
                </div>
              } @empty {
                 <div class="flex items-center justify-center h-full text-center text-gray-500">
                    <p>لا توجد رسائل في هذا النقاش. ابدأ محادثة!</p>
                 </div>
              }
            </div>
            <div class="p-4 border-t border-gray-200">
                <div class="flex items-center gap-2 mb-2">
                    @for(template of discussionTemplates(); track template) {
                        <button (click)="applyTemplate(template)" class="px-2 py-1 text-xs bg-gray-200 rounded-full hover:bg-gray-300">{{ template }}</button>
                    }
                </div>
                <form (submit)="$event.preventDefault(); sendMessage()" class="flex items-center gap-2">
                    <input [(ngModel)]="newMessageText" name="newMessage" type="text" placeholder="اكتب رسالتك..." class="flex-grow p-2 rounded-lg border border-gray-300 bg-gray-50">
                    <button type="submit" [disabled]="!newMessageText()" class="p-2 bg-ph-blue text-white rounded-lg disabled:bg-gray-400">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" /></svg>
                    </button>
                </form>
            </div>
          </div>
        }
        @case ('meeting') {
          <app-webrtc-call></app-webrtc-call>
        }
      }
    </div>
  } @else {
     <div class="flex items-center justify-center h-full text-center text-gray-500">
        <p>الرجاء اختيار مشروع للبدء.</p>
     </div>
  }
</div>

<!-- Create Project Modal -->
@if (isCreateProjectModalOpen()) {
  <div class="fixed inset-0 bg-black/50 z-40 flex items-center justify-center animate-fade-in" (click)="closeModals()">
    <div class="bg-base-100 rounded-lg shadow-xl w-full max-w-md p-6" (click)="$event.stopPropagation()">
      <h3 class="text-xl font-bold mb-4">إنشاء مشروع تحقيق جديد</h3>
      <form #projectForm="ngForm" (ngSubmit)="createProject()">
        <div>
          <label for="project-name" class="block mb-2 text-sm font-medium">اسم المشروع</label>
          <input type="text" name="project-name" [(ngModel)]="newProjectName" required class="w-full p-2.5 rounded-lg border border-gray-300 bg-gray-50">
        </div>
        <div class="mt-6 flex justify-end gap-3">
          <button type="button" (click)="closeModals()" class="px-4 py-2 text-sm rounded-lg bg-gray-200 hover:bg-gray-300">إلغاء</button>
          <button type="submit" [disabled]="projectForm.invalid" class="px-4 py-2 text-sm text-white rounded-lg bg-ph-blue hover:bg-ph-blue-dark disabled:bg-gray-400">إنشاء</button>
        </div>
      </form>
    </div>
  </div>
}

<!-- Invite Member Modal -->
@if (isInviteMemberModalOpen()) {
  <div class="fixed inset-0 bg-black/50 z-40 flex items-center justify-center animate-fade-in" (click)="closeModals()">
    <div class="bg-base-100 rounded-lg shadow-xl w-full max-w-md p-6" (click)="$event.stopPropagation()">
      <h3 class="text-xl font-bold mb-4">دعوة عضو جديد للمشروع</h3>
      <form #inviteForm="ngForm" (ngSubmit)="inviteMember(inviteEmail.value)">
        <div>
          <label for="invite-email" class="block mb-2 text-sm font-medium">البريد الإلكتروني للعضو</label>
          <input #inviteEmail type="email" name="invite-email" required email class="w-full p-2.5 rounded-lg border border-gray-300 bg-gray-50">
        </div>
        <div class="mt-6 flex justify-end gap-3">
          <button type="button" (click)="closeModals()" class="px-4 py-2 text-sm rounded-lg bg-gray-200 hover:bg-gray-300">إلغاء</button>
          <button type="submit" [disabled]="inviteForm.invalid" class="px-4 py-2 text-sm text-white rounded-lg bg-ph-blue hover:bg-ph-blue-dark disabled:bg-gray-400">إرسال دعوة</button>
        </div>
      </form>
    </div>
  </div>
}

<!-- Add New Task Modal -->
@if (isAddTaskModalOpen()) {
  <div class="fixed inset-0 bg-black/50 z-40 flex items-center justify-center animate-fade-in" (click)="closeModals()">
    <div class="bg-base-100 rounded-lg shadow-xl w-full max-w-lg p-6" (click)="$event.stopPropagation()">
      <h3 class="text-xl font-bold mb-4">إضافة مهمة جديدة</h3>
      <form #taskForm="ngForm" (ngSubmit)="saveNewTask()">
        <div class="space-y-4">
          <div>
            <label for="task-title" class="block mb-2 text-sm font-medium">عنوان المهمة</label>
            <input type="text" name="task-title" [(ngModel)]="newTaskTitle" required class="w-full p-2.5 rounded-lg border border-gray-300 bg-gray-50">
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label for="task-assignee" class="block mb-2 text-sm font-medium">إسناد إلى</label>
              @if(selectedProject(); as project){
                <select name="task-assignee" [(ngModel)]="newTaskAssigneeId" class="w-full p-2.5 rounded-lg border border-gray-300 bg-gray-50">
                  @for(member of project.team; track member.id) {
                    <option [value]="member.id">{{ member.name }}</option>
                  }
                </select>
              }
            </div>
            <div>
              <label for="task-priority" class="block mb-2 text-sm font-medium">الأولوية</label>
              <select name="task-priority" [(ngModel)]="newTaskPriority" class="w-full p-2.5 rounded-lg border border-gray-300 bg-gray-50">
                <option value="High">عالية</option>
                <option value="Medium">متوسطة</option>
                <option value="Low">منخفضة</option>
              </select>
            </div>
            <div>
              <label for="task-difficulty" class="block mb-2 text-sm font-medium">مستوى الصعوبة</label>
              <select name="task-difficulty" [(ngModel)]="newTaskDifficulty" class="w-full p-2.5 rounded-lg border border-gray-300 bg-gray-50">
                <option value="Easy">سهلة</option>
                <option value="Medium">متوسطة</option>
                <option value="Hard">صعبة</option>
              </select>
            </div>
          </div>
        </div>
        <div class="mt-6 flex justify-end gap-3">
          <button type="button" (click)="closeModals()" class="px-4 py-2 text-sm rounded-lg bg-gray-200 hover:bg-gray-300">إلغاء</button>
          <button type="submit" [disabled]="taskForm.invalid" class="px-4 py-2 text-sm text-white rounded-lg bg-ph-blue hover:bg-ph-blue-dark disabled:bg-gray-400">حفظ المهمة</button>
        </div>
      </form>
    </div>
  </div>
}
