<div class="grid grid-cols-1 lg:grid-cols-4 gap-6 h-full">
  <!-- Controls Column -->
  <div class="lg:col-span-1 bg-base-200 p-4 rounded-lg flex flex-col gap-4">
    <h3 class="text-lg font-bold border-b pb-2">لوحة التحكم</h3>
    
    <div>
      <label for="csv-upload" class="block mb-2 text-sm font-medium">1. تحميل بيانات CSV</label>
      <input id="csv-upload" type="file" (change)="handleFileInput($event)" accept=".csv" class="block w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 cursor-pointer focus:outline-none">
      <button (click)="loadSampleData()" class="mt-2 w-full text-sm text-ph-blue hover:underline">أو استخدم البيانات التجريبية</button>
    </div>
    
    @if (error()) {
        <p class="text-sm text-red-600 bg-red-100 p-2 rounded-md">{{ error() }}</p>
    }

    @if (data().length > 0) {
      <div>
        <label for="chart-type" class="block mb-2 text-sm font-medium">2. اختر نوع الرسم البياني</label>
        <select id="chart-type" [(ngModel)]="chartType" (change)="chartType.set($any($event.target).value)" class="bg-gray-50 border border-gray-300 text-sm rounded-lg block w-full p-2.5">
          <option value="bar">رسم بياني شريطي</option>
          <option value="scatter">مخطط التبعثر</option>
        </select>
      </div>

      <!-- Chart Specific Controls -->
      @if (chartType() === 'bar') {
        <div class="space-y-4 border-t pt-4">
          <h4 class="font-semibold">إعدادات الرسم الشريطي</h4>
          <div>
            <label for="bar-category" class="block mb-2 text-sm font-medium">المحور السيني (الفئة)</label>
            <select id="bar-category" [(ngModel)]="barCategory" (change)="barCategory.set($any($event.target).value)" class="bg-gray-50 border border-gray-300 text-sm rounded-lg block w-full p-2.5">
              @for (header of headers(); track header) { <option [value]="header">{{ header }}</option> }
            </select>
          </div>
          <div>
            <label for="bar-value" class="block mb-2 text-sm font-medium">المحور الصادي (القيمة)</label>
            <select id="bar-value" [(ngModel)]="barValue" (change)="barValue.set($any($event.target).value)" class="bg-gray-50 border border-gray-300 text-sm rounded-lg block w-full p-2.5">
              @for (header of headers(); track header) { <option [value]="header">{{ header }}</option> }
            </select>
          </div>
        </div>
      } @else if (chartType() === 'scatter') {
        <div class="space-y-4 border-t pt-4">
          <h4 class="font-semibold">إعدادات مخطط التبعثر</h4>
          <div>
            <label for="scatter-x" class="block mb-2 text-sm font-medium">المحور السيني (X)</label>
            <select id="scatter-x" [(ngModel)]="scatterX" (change)="scatterX.set($any($event.target).value)" class="bg-gray-50 border border-gray-300 text-sm rounded-lg block w-full p-2.5">
              @for (header of headers(); track header) { <option [value]="header">{{ header }}</option> }
            </select>
          </div>
          <div>
            <label for="scatter-y" class="block mb-2 text-sm font-medium">المحور الصادي (Y)</label>
            <select id="scatter-y" [(ngModel)]="scatterY" (change)="scatterY.set($any($event.target).value)" class="bg-gray-50 border border-gray-300 text-sm rounded-lg block w-full p-2.5">
              @for (header of headers(); track header) { <option [value]="header">{{ header }}</option> }
            </select>
          </div>
        </div>
      }
    }
  </div>

  <!-- Chart Display Column -->
  <div class="lg:col-span-3">
    @if (data().length > 0) {
      <svg #chartContainer></svg>
    } @else {
      <div class="flex items-center justify-center h-full border-2 border-dashed rounded-lg text-center text-gray-500">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-12 h-12 mx-auto mb-2"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6a7.5 7.5 0 1 0 7.5 7.5h-7.5V6Z" /><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 10.5H21A7.5 7.5 0 0 0 13.5 3v7.5Z" /></svg>
          <p class="font-semibold">منطقة عرض الرسم البياني</p>
          <p class="text-sm">يرجى رفع ملف CSV لبدء التصور.</p>
        </div>
      </div>
    }
  </div>
</div>
