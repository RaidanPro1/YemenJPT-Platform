@if (userService.isAuthenticated()) {
  <div class="relative min-h-screen lg:flex">
    <!-- Sidebar -->
    <app-sidebar 
      [activePage]="currentPage()"
      [isSidebarOpen]="isSidebarOpen()"
      (navigate)="handleNavigation($event)"></app-sidebar>

    <!-- Main content -->
    <div class="flex flex-col flex-1 lg:mr-64 min-h-screen">
      <!-- Header -->
      <app-header 
        [isAuthenticated]="true"
        [user]="userService.currentUser()"
        (toggleSidebar)="toggleSidebar()"
        (logout)="handleLogout()"
        (navigate)="handleNavigation($event)"></app-header>
      
      <!-- Page Content -->
      <main class="p-4 md:p-8 flex-1">
        <!-- DEMO: User Role Switcher -->
        <div class="absolute top-24 left-4 bg-yellow-200 p-2 rounded-lg shadow-lg z-50">
          <label class="text-xs font-bold text-gray-800">عرض تجريبي:</label>
          <select (change)="switchUser($any($event.target).value)" class="text-xs rounded bg-white">
            <option value="investigative-journalist" [selected]="userService.currentUser()?.role === 'investigative-journalist'">صحفي استقصائي</option>
            <option value="editor-in-chief" [selected]="userService.currentUser()?.role === 'editor-in-chief'">مدير التحرير</option>
            <option value="super-admin" [selected]="userService.currentUser()?.role === 'super-admin'">مدير عام</option>
          </select>
        </div>

        @switch (currentPage()) {
          @case ('dashboard') { <app-dashboard></app-dashboard> }
          @case ('workspace') { <app-journalist-workspace></app-journalist-workspace> }
          @case ('editorial') { <app-editorial-hub></app-editorial-hub> }
          @case ('command-center') { <app-command-center></app-command-center> }
          @case ('ai-core') { <app-ai-core></app-ai-core> }
          @case ('social-media') { <app-social-media-analysis></app-social-media-analysis> }
          @case ('collaboration') { <app-collaboration></app-collaboration> }
          @case ('admin') { <app-admin></app-admin> }
          @case ('indilab') { <app-indilab></app-indilab> }
          @case ('maps') { <app-maps></app-maps> }
          @case ('archiving') { <app-archiving></app-archiving> }
          @case ('users') { <app-user-management (navigate)="handleNavigation($event)"></app-user-management> }
          @case ('documentation') { <app-documentation></app-documentation> }
          @case ('settings') { <app-settings></app-settings> }
          @case ('automation') { <app-automation></app-automation> }
          @case ('profile') { <app-profile></app-profile> }
          @case ('system-internals') { <app-system-internals></app-system-internals> }
          @case ('erp') { <app-erp></app-erp> }
          @case ('privacy-policy') { <app-privacy-policy (navigate)="handleNavigation($event)"></app-privacy-policy> }
          @case ('terms-of-service') { <app-terms-of-service (navigate)="handleNavigation($event)"></app-terms-of-service> }
          @case ('cookie-policy') { <app-cookie-policy></app-cookie-policy> }
          @case ('disclaimer') { <app-disclaimer></app-disclaimer> }
          @case ('project-management') { <app-project-management-portal></app-project-management-portal> }
          @case ('violations-observatory') { <app-violations-observatory></app-violations-observatory> }
          @case ('training') { <app-training-portal></app-training-portal> }
          @case ('tech-support') { <app-tech-support-portal></app-tech-support-portal> }
          @default { <app-placeholder [pageTitle]="currentPage()"></app-placeholder> }
        }
      </main>
      
      <app-footer (navigate)="handleNavigation($event)"></app-footer>
    </div>
  </div>
} @else {
  <div class="min-h-screen flex flex-col">
    <app-header 
      [isAuthenticated]="false" 
      (login)="handleLogin()"
      (navigate)="handleNavigation($event)"></app-header>
    <main class="flex-grow">
      @switch (currentPage()) {
        @case ('home') { <app-home (login)="handleLogin()" (navigate)="handleNavigation($event)"></app-home> }
        @case ('about') { <app-about-us></app-about-us> }
        @case ('privacy-policy') { <app-privacy-policy (navigate)="handleNavigation($event)"></app-privacy-policy> }
        @case ('terms-of-service') { <app-terms-of-service (navigate)="handleNavigation($event)"></app-terms-of-service> }
        @case ('cookie-policy') { <app-cookie-policy></app-cookie-policy> }
        @case ('disclaimer') { <app-disclaimer></app-disclaimer> }
        @case ('register') { <app-register (register)="handleRegister()" (navigate)="handleNavigation($event)"></app-register> }
        @case ('violations-observatory-public') { <app-violations-observatory-public (login)="handleLogin()"></app-violations-observatory-public> }
        @case ('training-portal-public') { <app-training-portal-public (login)="handleLogin()"></app-training-portal-public> }
        @case ('tech-support-public') { <app-tech-support-public (login)="handleLogin()"></app-tech-support-public> }
        @case ('news-public') { <app-news-public (login)="handleLogin()"></app-news-public> }
        @case ('projects-public') { <app-projects-public (login)="handleLogin()"></app-projects-public> }
        @default { <app-home (login)="handleLogin()" (navigate)="handleNavigation($event)"></app-home> }
      }
    </main>
    <app-footer (navigate)="handleNavigation($event)"></app-footer>
  </div>
}

@if (trialService.showLoginModal()) {
  <app-login-modal (login)="handleLogin()" (close)="trialService.closeModal()" (navigate)="handleNavigation($event)"></app-login-modal>
}

@if (showOnboarding()) {
  <app-onboarding (finish)="handleFinishOnboarding()"></app-onboarding>
}

<app-confirmation-modal></app-confirmation-modal>